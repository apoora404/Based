<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Basedapp Checker</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <style>
    :root { color-scheme: dark; }
    .num { font-variant-numeric: tabular-nums; }
    /* PNG ì €ì¥ìš©: ëª¨ë“  í…ìŠ¤íŠ¸ ê°•ì œ í°ìƒ‰ */
    .png-export * { color: #ffffff !important; }
  </style>
</head>
<body class="min-h-screen bg-slate-950 text-slate-100">
  <header class="max-w-4xl mx-auto px-4 py-6 text-center">
    <h1 class="text-2xl sm:text-3xl font-bold">ğŸ“Š Basedapp Checker</h1>
    <p class="mt-2 text-slate-400 text-sm">ì´ì „/í˜„ì¬ ê±°ë˜ëŸ‰Â·í¬ì¸íŠ¸ ì…ë ¥ ì‹œ â†’ ì‚¬ìš© êµ¬ê°„ ê±°ë˜ëŸ‰/XP/ìˆ˜ìˆ˜ë£Œ/ë¦¬ë² ì´íŠ¸ ìë™ ê³„ì‚°</p>
  </header>

  <main class="max-w-4xl mx-auto px-4 pb-28 space-y-5">
    <!-- ì…ë ¥ ì˜ì—­ -->
    <section class="bg-slate-900/60 border border-slate-800 rounded-2xl p-4 space-y-4">
      <div class="grid sm:grid-cols-2 gap-3">
        <label class="block">
          <span class="block text-xs text-slate-400">ì´ì „ ê±°ë˜ëŸ‰ ($, ëˆ„ì )</span>
          <input id="prevVol" type="number" placeholder="ì˜ˆ: 200000" class="mt-1 w-full rounded-xl bg-slate-900 border border-slate-700 p-2" />
        </label>
        <label class="block">
          <span class="block text-xs text-slate-400">í˜„ì¬ ê±°ë˜ëŸ‰ ($, ëˆ„ì )</span>
          <input id="currVol" type="number" placeholder="ì˜ˆ: 290000" class="mt-1 w-full rounded-xl bg-slate-900 border border-slate-700 p-2" />
        </label>
      </div>

      <div class="grid sm:grid-cols-2 gap-3">
        <label class="block">
          <span class="block text-xs text-slate-400">ì´ì „ í¬ì¸íŠ¸ (ëˆ„ì )</span>
          <input id="prevPts" type="number" placeholder="ì˜ˆ: 12000" class="mt-1 w-full rounded-xl bg-slate-900 border border-slate-700 p-2" />
        </label>
        <label class="block">
          <span class="block text-xs text-slate-400">í˜„ì¬ í¬ì¸íŠ¸ (ëˆ„ì )</span>
          <input id="currPts" type="number" placeholder="ì˜ˆ: 20000" class="mt-1 w-full rounded-xl bg-slate-900 border border-slate-700 p-2" />
        </label>
      </div>

      <div class="grid sm:grid-cols-2 gap-3">
        <label class="block">
          <span class="block text-xs text-slate-400">ì´ì „ ìˆ˜ìˆ˜ë£Œ ($)</span>
          <input id="prevFee" type="number" placeholder="ì˜ˆ: 50" class="mt-1 w-full rounded-xl bg-slate-900 border border-slate-700 p-2" />
        </label>
        <label class="block">
          <span class="block text-xs text-slate-400">í˜„ì¬ ìˆ˜ìˆ˜ë£Œ ($)</span>
          <input id="currFee" type="number" placeholder="ì˜ˆ: 120" class="mt-1 w-full rounded-xl bg-slate-900 border border-slate-700 p-2" />
        </label>
      </div>

      <div class="flex gap-2 mt-4">
        <button id="calc" class="px-4 py-2 rounded-xl bg-indigo-600 hover:bg-indigo-500 text-white font-medium">ê³„ì‚°í•˜ê¸°</button>
        <button id="reset" class="px-4 py-2 rounded-xl bg-slate-800 hover:bg-slate-700 border border-slate-700">ì´ˆê¸°í™”</button>
        <button id="copy" class="px-4 py-2 rounded-xl bg-slate-800 hover:bg-slate-700 border border-slate-700">ë³µì‚¬</button>
        <button id="save" class="px-4 py-2 rounded-xl bg-slate-800 hover:bg-slate-700 border border-slate-700">PNG ì €ì¥</button>
      </div>
    </section>

    <!-- ê²°ê³¼ ì˜ì—­ -->
    <section class="bg-slate-900/60 border border-slate-800 rounded-2xl p-4 space-y-3">
      <h3 class="font-semibold">ê²°ê³¼</h3>
      <div id="out" class="space-y-2"></div>
    </section>
  </main>

  <!-- PNG Export ìˆ¨ê¹€ ë£¨íŠ¸ -->
  <div id="png-export-root" style="position:fixed; left:-99999px; top:-99999px;"></div>

  <script>
    const $ = id => document.getElementById(id);

    function compute() {
      const prevVol = Number($("prevVol").value || 0);
      const currVol = Number($("currVol").value || 0);
      const prevPts = Number($("prevPts").value || 0);
      const currPts = Number($("currPts").value || 0);
      const prevFee = Number($("prevFee").value || 0);
      const currFee = Number($("currFee").value || 0);

      const usedVol = Math.max(0, currVol - prevVol);
      const usedPts = Math.max(0, currPts - prevPts);
      const usedFee = Math.max(0, currFee - prevFee);

      // XP íš¨ìœ¨
      const xpEfficiency = usedVol > 0 ? (usedPts / usedVol) : 0;
      const volPerXp = usedPts > 0 ? (usedVol / usedPts) : 0;

      // ìˆ˜ìˆ˜ë£Œ ê³„ì‚°
      const totalFee = usedFee || usedVol * 0.00015; // ê¸°ë³¸ maker ê°€ì •
      const avgFeeRate = usedVol > 0 ? totalFee / usedVol : 0;

      const rebate = totalFee * 0.6;
      const netFee = totalFee - rebate;

      const costPerXp = usedPts > 0 ? netFee / usedPts : 0;

      const d2 = n => Number(n).toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 });
      const d4 = n => Number(n).toLocaleString(undefined, { minimumFractionDigits: 4, maximumFractionDigits: 4 });

      let rows = [];
      rows.push(`<div>ì‚¬ìš© ê±°ë˜ëŸ‰: ${d2(usedVol)} $</div>`);
      rows.push(`<div>íšë“ XP: ${d2(usedPts)} XP</div>`);
      rows.push(`<div>XP íš¨ìœ¨: ${d4(xpEfficiency)} XP/$</div>`);
      rows.push(`<div>1 XPë‹¹ ê±°ë˜ëŸ‰: ${d4(volPerXp)} $/XP</div>`);
      rows.push(`<div>ì´ ìˆ˜ìˆ˜ë£Œ(ë¦¬ë² ì´íŠ¸ ì „): ${d2(totalFee)} $</div>`);
      rows.push(`<div>í‰ê·  ìˆ˜ìˆ˜ë£Œìœ¨: ${(avgFeeRate*100).toFixed(4)} %</div>`);
      rows.push(`<div>ì…€í”„ë ˆí¼ëŸ´ ìˆ˜ìµ(60%): ${d2(rebate)} $</div>`);
      rows.push(`<div>ì‹¤ì œ ë‚¸ ìˆ˜ìˆ˜ë£Œ(ë¦¬ë² ì´íŠ¸ í›„): ${d2(netFee)} $</div>`);
      rows.push(`<div>1 XPë‹¹ ì‹¤ì§ˆ ë¹„ìš©(ìˆ˜ìˆ˜ë£Œë§Œ): ${d4(costPerXp)} $/XP</div>`);

      $("out").innerHTML = `<div class='space-y-1'>${rows.join("")}</div>`;
    }

    $("calc").addEventListener("click", compute);
    $("reset").addEventListener("click", () => {
      ['prevVol','currVol','prevPts','currPts','prevFee','currFee'].forEach(id => $(id).value = '');
      $("out").innerHTML = '';
    });
    $("copy").addEventListener("click", () => {
      const text = $("out").innerText;
      navigator.clipboard.writeText(text);
      alert("ê²°ê³¼ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!");
    });
    $("save").addEventListener("click", async () => {
      const src = document.querySelector("#out");
      if (!src || !src.firstElementChild) { alert("ì €ì¥í•  ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤."); return; }
      const clone = src.cloneNode(true);
      clone.classList.add("png-export");
      const root = document.getElementById("png-export-root");
      root.innerHTML = "";
      root.appendChild(clone);
      const canvas = await html2canvas(clone, {
        backgroundColor: "#0e0f12",
        scale: 3,
        useCORS: true
      });
      const a = document.createElement("a");
      a.download = "basedapp_checker_result.png";
      a.href = canvas.toDataURL("image/png");
      a.click();
      root.innerHTML = "";
    });
  </script>
</body>
</html>
