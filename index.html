<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>XP 효율 · 수수료 계산기</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root{color-scheme:dark light}
    .num{font-variant-numeric:tabular-nums}
    input[type="range"]{accent-color:#6366f1}
  </style>
</head>
<body class="min-h-screen bg-slate-950 text-slate-100">
  <header class="max-w-5xl mx-auto px-4 py-6">
    <div class="flex items-center justify-between gap-3">
      <h1 class="text-xl sm:text-2xl font-semibold">XP 효율 · 수수료 계산기</h1>
      <div class="text-xs sm:text-sm text-slate-400">v1.3 · 단일 파일 · 오프라인 동작 · 자동 저장(localStorage)</div>
    </div>
    <p class="mt-2 text-slate-400 text-sm">요청 반영: Taker 슬라이더 제거, 수수료 클래스/티어 제거 → <b>Base</b> 고정 + <b>14일 볼륨 티어</b> 선택. 입력모드 분리 없이 <b>거래량/포인트 둘 다 입력 가능</b>.</p>
  </header>

  <main class="max-w-5xl mx-auto px-4 pb-28 space-y-5">
    <!-- Controls -->
    <section class="grid md:grid-cols-3 gap-4">
      <div class="md:col-span-2 space-y-4">
        <!-- Trading mode / XP boost -->
        <div class="bg-slate-900/60 border border-slate-800 rounded-2xl p-4">
          <div class="grid sm:grid-cols-3 gap-3">
            <label class="block">
              <span class="block text-xs text-slate-400">거래 방식</span>
              <select id="marketKind" class="mt-1 w-full rounded-xl bg-slate-900 border border-slate-700 p-2">
                <option value="perps">선물(Perps)</option>
                <option value="spot">현물(Spot)</option>
              </select>
            </label>
            <label class="block">
              <span class="block text-xs text-slate-400">XP 부스트</span>
              <select id="xpBoost" class="mt-1 w-full rounded-xl bg-slate-900 border border-slate-700 p-2">
                <option value="0">0%</option>
                <option value="25">25%</option>
                <option value="50">50%</option>
                <option value="60" selected>60%</option>
              </select>
            </label>
            <label class="block">
              <span class="block text-xs text-slate-400">XP 효율 (XP / $)</span>
              <input id="xpPerDollar" type="number" step="0.00001" class="mt-1 w-full rounded-xl bg-slate-900 border border-slate-700 p-2" />
              <span class="text-[11px] text-slate-500">프리셋 자동 계산, 필요시 직접 수정 가능</span>
            </label>
          </div>
        </div>

        <!-- Fees (Base only) & boost -->
    <section class="grid md:grid-cols-3 gap-4">
      <div class="md:col-span-2 space-y-4">
        <div class="bg-slate-900/60 border border-slate-800 rounded-2xl p-4">
          <div class="grid sm:grid-cols-3 gap-3">
            <label class="block">
              <span class="block text-xs text-slate-400">거래 방식</span>
              <select id="marketKind" class="mt-1 w-full rounded-xl bg-slate-900 border border-slate-700 p-2">
                <option value="perps" selected>선물(Perps)</option>
                <option value="spot">현물(Spot)</option>
              </select>
            </label>
            <label class="block">
              <span class="block text-xs text-slate-400">XP 부스트</span>
              <select id="xpBoost" class="mt-1 w-full rounded-xl bg-slate-900 border border-slate-700 p-2">
                <option value="0">0%</option>
                <option value="25">25%</option>
                <option value="50">50%</option>
                <option value="60" selected>60%</option>
              </select>
            </label>
            <label class="block">
              <span class="block text-xs text-slate-400">XP 효율 (XP/$)</span>
              <input id="xpPerDollar" type="number" step="0.00001" class="mt-1 w-full rounded-xl bg-slate-900 border border-slate-700 p-2" />
              <span class="text-[11px] text-slate-500">프리셋 자동 계산, 필요시 직접 수정 가능</span>
            </label>
          </div>
        </div>

        <div class="bg-slate-900/60 border border-slate-800 rounded-2xl p-4">
          <div class="flex items-center justify-between mb-2">
            <h3 class="font-semibold">수수료 선택 (Base 고정)</h3>
            <div class="text-xs text-slate-400">14일 가중 거래량으로 티어 선택</div>
          </div>
          <div class="grid sm:grid-cols-4 gap-3">
            <label class="block col-span-2">
              <span class="block text-xs text-slate-400">14일 가중 거래량 티어</span>
              <select id="tier14" class="mt-1 w-full rounded-xl bg-slate-900 border border-slate-700 p-2">
                <option value="0">Tier 0 (기본)</option>
                <option value="1">Tier 1 (> $5M)</option>
                <option value="2">Tier 2 (> $25M)</option>
                <option value="3">Tier 3 (> $100M)</option>
                <option value="4">Tier 4 (> $500M)</option>
                <option value="5">Tier 5 (> $2B)</option>
                <option value="6">Tier 6 (> $7B)</option>
              </select>
            </label>
            <label class="block">
              <span class="block text-xs text-slate-400">Taker 수수료율(%)</span>
              <input id="takerFee" type="number" step="0.0001" value="0.045" class="mt-1 w-full rounded-xl bg-slate-900 border border-slate-700 p-2" />
              <span class="text-[11px] text-slate-500">티어 선택 시 자동 반영</span>
            </label>
            <label class="block">
              <span class="block text-xs text-slate-400">Maker 수수료율(%)</span>
              <input id="makerFee" type="number" step="0.0001" value="0.015" class="mt-1 w-full rounded-xl bg-slate-900 border border-slate-700 p-2" />
            </label>
          </div>
        </div>

        <!-- Inputs: both available -->
        <div class="bg-slate-900/60 border border-slate-800 rounded-2xl p-4">
          <div class="grid sm:grid-cols-3 gap-3">
            <label class="block">
              <span class="block text-xs text-slate-400">총 거래량 ($)</span>
              <input id="volume" type="number" step="0.01" value="" placeholder="예: 82881.86" class="mt-1 w-full rounded-xl bg-slate-900 border border-slate-700 p-2" />
            </label>
            <label class="block">
              <span class="block text-xs text-slate-400">이전 포인트</span>
              <input id="prevPts" type="number" step="0.01" placeholder="선택" class="mt-1 w-full rounded-xl bg-slate-900 border border-slate-700 p-2" />
            </label>
            <label class="block">
              <span class="block text-xs text-slate-400">현재 포인트</span>
              <input id="currPts" type="number" step="0.01" placeholder="선택" class="mt-1 w-full rounded-xl bg-slate-900 border border-slate-700 p-2" />
            </label>
          </div>

          <details class="mt-3 text-sm text-slate-300">
            <summary class="cursor-pointer select-none">고급 옵션(선택): 실제 납부 수수료 / 추천인 수익으로 Taker 비율 역산</summary>
            <div class="grid sm:grid-cols-4 gap-3 mt-2">
              <label class="block">
                <span class="block text-xs text-slate-400">실제 납부 수수료($)</span>
                <input id="feePaid" type="number" step="0.01" class="mt-1 w-full rounded-xl bg-slate-900 border border-slate-700 p-2" />
              </label>
              <label class="block">
                <span class="block text-xs text-slate-400">추천인 수익($)</span>
                <input id="refRev" type="number" step="0.01" class="mt-1 w-full rounded-xl bg-slate-900 border border-slate-700 p-2" />
              </label>
              <label class="block">
                <span class="block text-xs text-slate-400">추천인 배분율 r(%)</span>
                <input id="refShare" type="number" step="0.1" value="60" class="mt-1 w-full rounded-xl bg-slate-900 border border-slate-700 p-2" />
              </label>
              <label class="block">
                <span class="block text-xs text-slate-400">평균 1회 체결 금액($, 선택)</span>
                <input id="avgFill" type="number" step="0.01" placeholder="예: 3,000" class="mt-1 w-full rounded-xl bg-slate-900 border border-slate-700 p-2" />
              </label>
            </div>
          </details>

          <div class="flex gap-2 mt-4">
            <butto

    <section class="text-xs text-slate-500">
      <p>저장 방식: 브라우저 <b>localStorage</b> 사용(쿠키 불필요). 장치/브라우저를 바꾸면 동기화되지 않습니다. 여러 장치에서 동기화하려면 서버 저장이 필요합니다.</p>
    </section>
  </main>

  <script>
    // === XP 효율 프리셋 ===
    // futures 0% = 0.03375 → 부스트 계수(1, 1.25, 1.5, 1.6)
    // spot    0% = 0.1266  → 동일 계수 적용
    const XP_BASE = { perps: 0.03375, spot: 0.1266 };
    const BOOST_FACTOR = {0:1, 25:1.25, 50:1.5, 60:1.6};

    // === Perps fee tiers ===
    const TIERS = {
      Base:  {0:{t:0.045,m:0.015},1:{t:0.040,m:0.012},2:{t:0.035,m:0.008},3:{t:0.030,m:0.004},4:{t:0.028,m:0.000},5:{t:0.026,m:0.000},6:{t:0.024,m:0.000}},
      Diamond:{0:{t:0.0270,m:0.0090},1:{t:0.0240,m:0.0072},2:{t:0.0210,m:0.0048},3:{t:0.0180,m:0.0024},4:{t:0.0168,m:0.0000},5:{t:0.0156,m:0.0000},6:{t:0.0144,m:0.0000}},
      Platinum:{0:{t:0.0315,m:0.0105},1:{t:0.0280,m:0.00849},2:{t:0.0245,m:0.00569},3:{t:0.0210,m:0.00289},4:{t:0.0196,m:0.00009},5:{t:0.0182,m:0.00009},6:{t:0.0168,m:0.00009}}
    };

    const $ = id => document.getElementById(id);

    function updateXpEfficiency(){
      const kind = $('marketKind').value;  // perps | spot
      const boost = $('xpBoost').value;    // 0/25/50/60
      const base = XP_BASE[kind] || 0.03375;
      constsList.toggle('hidden', m!=="points");
    }

    function compute(){
      const takerRatio = Number($('takerRatio').value)/100;
      const makerRatio = 1 - takerRatio;
      const takerFee = Number($('takerFee').value)/100; // % → 1기준
      const makerFee = Number($('makerFee').value)/100;
      const avgFee = takerRatio*takerFee + makerRatio*makerFee;
      const xpPerDollar = Number($('xpPerDollar').value);

      let volume = 0, gainedXP = 0;
      if($('mode').value === 'volume'){
        volume = Number($('volume').value||0);
        gainedXP = v.toFixed(2);
      }

      const feeGross = volume * avgFee; // 총 수수료(달러)

      // 출력
      const d2 = n=> Number(n).toLocaleString(undefined,{minimumFractionDigits:2, maximumFractionDigits:2});
      co"grid grid-cols-2 gap-2">
            <div class="bg-slate-950/60 p-3 rounded-xl border border-slate-800"><div class="text-[11px] text-slate-400">획득 포인트</div><div class="text-xl">${d2(gainedXP)}</div></div>
            <div class="bg-slate-950/60 p-3 rounded-xl border border-slate-800"><div class="text-[11px] text-slate-400">총 거래량</div><div class="text-xl">${d2(volume)} $</div></div>
          </div>
          <div class="grid grid-cols-2 gap-2">
            <div class="bg-slate-950/60 p-3 rounded-xl border border-slate-800"><div class="text-[11px] text-slate-400">총 수수료(평균)</div><div class="text-xl">${d2(feeGross)} $</div><div class="text-[11px] text-slate-400">(Taker ${d4(takerFee*100)}% × ${d4(takerRatio*100)}% + Maker ${d4(makerFee*100)}% × ${d4(makerRatio*100)}%)</div></div>
            <div class="bg-slate-950/60 p-3 rounded-xl border border-slate-800"><div class="text-[11px] text-slate-400">1 XP 당 거래량</div><div class="text-xl">${gainedXP>0? d4(volume/gainedXP): '—'} $/XP</div></div>
          </div>
        </div>`;
    }

    function saveInputs(){
      const keys = ['marketKind','xpBoost','xpPerDollar','tierClass','tier','takerFee','makerFee','takerRatio','refShare','mode','volume','prevPts','currPts'];
      const obj = {}; keys.forEach(k=> obj[k] = $(k).value);
      localStorage.setItem('xp-fee-calc', JSON.stringify(obj));
      const btn = $('save'); btn.textContent = '저장됨'; setTimeout(()=>btn.textContent='입력값 저장', 1200);
    }

    function loadInputs(){
      const raw = localStorage.getItem('xp-fee-calc'); if(!raw){ updateXpEfficiency(); return; }
      try{
        const obj = JSON.parse(raw);
        Object.keys(obj).forEach(k=> { if($(k)) $(k).value = obj[k]; });
      }catch{}
      $('takerRatioLbl').textContent = $('takerRatio').value; $('makerRatioLbl').textContent = 100-Number($('takerRatio').value);
      updateXpEfficiency(); applyTierPreset(); toggleMode(); compute();
    }

    // UI events
    $('xpBoost').addEventListener('change', ()=>{ updateXpEfficiency(); });
    $('marketKind').addEventListener('change', ()=>{ updateXpEfficiency(); });
    $('tierClass').addEventListener('change', ()=>{ applyTierPreset(); });
    $('tier').addEventListener('change', ()=>{ applyTierPreset(); });
    $('takerRatio').addEventListener('input', ()=>{ $('takerRatioLbl').textContent = $('takerRatio').value; $('makerRatioLbl').textContent = 100-Number($('takerRatio').value); });
    $('mode').addEventListener('change', ()=>{ toggleMode(); });
    $('calc').addEventListener('click', compute);
    $('save').addEventListener('click', saveInputs);
    $('reset').addEventListener('click', ()=>{ localStorage.removeItem('xp-fee-calc'); location.reload(); });

    // init
    updateXpEfficiency();
    loadInputs();
  </script>
</body>
</html>
