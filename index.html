<script>
  // 이미 html2canvas를 불러왔다고 가정 (없으면 <head>에 CDN 추가)
  // <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

  // PNG 저장 버튼
  document.getElementById('save').addEventListener('click', async () => {
    // 1) 화면에 보이는 결과 카드 루트 선택 (여기만 너의 셀렉터로 바꿔줘)
    const src = document.querySelector('#out'); // ← 예시. 네 코드에 맞게 수정

    if (!src || !src.firstElementChild) {
      alert('저장할 결과가 없습니다. 먼저 계산하세요.');
      return;
    }

    // 2) 기존 결과 카드를 그대로 복제
    const clone = src.cloneNode(true);

    // 3) PNG용 스타일 강제 적용
    clone.classList.add('png-export');

    // (선택) 카드 배경 컬러가 너무 어두우면 보기 좋게 약간만 밝게:
    // clone.style.background = '#0f172a';

    // 4) 숨김 루트에 붙여서 캔버스로 캡처
    const root = document.getElementById('png-export-root');
    root.innerHTML = '';           // 이전 것 제거
    root.appendChild(clone);

    // 5) 캡처 (배경/스케일 튜닝)
    const canvas = await html2canvas(clone, {
      backgroundColor: '#0e0f12',  // PNG 배경
      scale: 3,                    // 해상도 업샘플링
      useCORS: true
    });

    // 6) 다운로드
    const a = document.createElement('a');
    a.download = 'basedapp_checker_result.png';
    a.href = canvas.toDataURL('image/png');
    a.click();

    // 7) 정리
    root.innerHTML = '';
  });
</script>
